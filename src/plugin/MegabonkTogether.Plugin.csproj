<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net6.0</TargetFramework>
    <AssemblyName>MegabonkTogether</AssemblyName>
    <Product>MegabonkTogether</Product>
    <Version>1.3.0</Version>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <LangVersion>latest</LangVersion>
    <RestoreAdditionalProjectSources>
      https://api.nuget.org/v3/index.json;
      https://nuget.bepinex.dev/v3/index.json;
      https://nuget.samboy.dev/v3/index.json
    </RestoreAdditionalProjectSources>
    <RootNamespace>MegabonkTogether</RootNamespace>
  </PropertyGroup>

  <!-- Define THUNDERSTORE when THUNDERSTORE_BUILD environment variable is set (For GitHub Actions) -->
  <PropertyGroup Condition=" '$(THUNDERSTORE_BUILD)' == 'true' ">
    <DefineConstants>$(DefineConstants);THUNDERSTORE</DefineConstants>
  </PropertyGroup>

	<PropertyGroup>
		<CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
	</PropertyGroup>

	<ItemGroup>
    <PackageReference Include="BepInEx.Unity.IL2CPP" Version="6.0.0-be.*" IncludeAssets="compile" />
    <PackageReference Include="BepInEx.PluginInfoProps" Version="2.*" />
    <PackageReference Include="LiteNetLib" Version="1.3.5" />
	<PackageReference Include="Microsoft.Extensions.Hosting" Version="6.0.1" />
	<PackageReference Include="Profanity.Detector" Version="0.1.8" />
	</ItemGroup>

	<PropertyGroup>
	  <!-- Use MegabonkPath if provided (local) -->
	  <AssemblyPath Condition=" '$(MegabonkPath)' != '' ">$(MegabonkPath)/BepInEx/interop</AssemblyPath>
	  <UnityLibPath Condition=" '$(MegabonkPath)' != '' ">$(MegabonkPath)/BepInEx/unity-libs</UnityLibPath>
	  <PluginPath Condition=" '$(MegabonkPath)' != '' ">$(MegabonkPath)/BepInEx/plugins</PluginPath>

	  <!-- Otherwise default to the stripper project's committed output (GitHub Actions) -->
	  <AssemblyPath Condition=" '$(AssemblyPath)' == '' ">$(MSBuildProjectDirectory)/stripped-libs/interop</AssemblyPath>
	  <UnityLibPath Condition=" '$(UnityLibPath)' == '' ">$(MSBuildProjectDirectory)/stripped-libs/unity-libs</UnityLibPath>
	</PropertyGroup>

	<ItemGroup>
	  <ProjectReference Include="..\common\MegabonkTogether.Common.csproj" />
	</ItemGroup>

	<ItemGroup>
		<Reference Include="Assembly-CSharp">
			<HintPath>$(AssemblyPath)/Assembly-CSharp.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="UnityEngine.CoreModule">
			<HintPath>$(UnityLibPath)/UnityEngine.CoreModule.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="UnityEngine.AnimationModule">
			<HintPath>$(UnityLibPath)/UnityEngine.AnimationModule.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="UnityEngine.PhysicsModule">
			<HintPath>$(UnityLibPath)/UnityEngine.PhysicsModule.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="UnityEngine.ParticleSystem">
			<HintPath>$(UnityLibPath)/UnityEngine.ParticleSystemModule.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="UnityEngine.AudioModule">
			<HintPath>$(UnityLibPath)/UnityEngine.AudioModule.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="UnityEngine.UI">
			<HintPath>$(AssemblyPath)/UnityEngine.UI.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="Unity.TextMeshPro">
			<HintPath>$(AssemblyPath)/Unity.TextMeshPro.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="Il2Cpp.Mscorlib">
			<HintPath>$(AssemblyPath)/Il2Cppmscorlib.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="Il2CppSystem.dll">
			<HintPath>$(AssemblyPath)/Il2CppSystem.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="Il2CppSystem.Core.dll">
			<HintPath>$(AssemblyPath)/Il2CppSystem.Core.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="Rewired_Core">
			<HintPath>$(AssemblyPath)/Rewired_Core.dll</HintPath>
			<Private>false</Private>
		</Reference>
		<Reference Include="UnityEngine.Localization">
			<HintPath>$(AssemblyPath)/Unity.Localization.dll</HintPath>
			<Private>false</Private>
		</Reference>
	</ItemGroup>

	<!-- Skip PostBuild copy when running in CI (GitHub Actions or other CI systems setting CI env var) -->
	<Target Name="PostBuild" AfterTargets="PostBuildEvent" Condition=" '$(GITHUB_ACTIONS)' != 'true' And '$(CI)' != 'true' ">
		<Exec Command="xcopy /Y /I &quot;$(TargetDir)&quot; &quot;$(PluginPath)\\MegabonkTogether&quot;" Condition=" '$(PluginPath)' != '' And '$(Configuration)' == 'Debug' And '$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::Windows)))' " />
	</Target>
</Project>
